<!--
***********************************************************************************************
Microsoft.DotNet.Publishing.targets  

WARNING:  DO NOT MODIFY this file unless you are knowledgeable about MSBuild and have
          created a backup copy.  Incorrect changes to this file will make it
          impossible to load or build your web deploy projects from the command-line or the IDE.

This file defines the steps in the standard build process to deploy web application projects.

Copyright (C) Microsoft Corporation. All rights reserved.
***********************************************************************************************
-->

<!-- -->

<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003">

  <PropertyGroup>
    <DotNetPublishingTasksDir Condition=" '$(DotNetPublishingTasksDir)'=='' ">$(MSBuildThisFileDirectory)..\</DotNetPublishingTasksDir>
    <DotNetPublishingSaveFilesDirectory Condition=" '$(DotNetPublishingSaveFilesDirectory)' == ''">$(MSBuildThisFileDirectory)..\SaveTargets</DotNetPublishingSaveFilesDirectory>
    <DotNetPublishingCollectFilesDirectory Condition=" '$(DotNetPublishingCollectFilesTargetsDir)'=='' ">$(MSBuildThisFileDirectory)..\CollectTargets</DotNetPublishingCollectFilesDirectory>
    <DotNetPublishingTransformFilesDirectory Condition=" '$(DotNetPublishingCollectFilesTargetsDir)'=='' ">$(MSBuildThisFileDirectory)..\TransformTargets</DotNetPublishingTransformFilesDirectory>
    <DotNetPublishingDeployFilesDirectory Condition=" '$(DotNetPublishingDeployTargetsDir)'=='' ">$(MSBuildThisFileDirectory)..\DeployTargets</DotNetPublishingDeployFilesDirectory>
  </PropertyGroup>

  <!-- 
  ***********************************************************************************************
  Global Properties
  ***********************************************************************************************
  -->

  <Import Project="$(MSBuildThisFileDirectory)\..\Microsoft.DotNet.Publishing.Props" />


  <!--
  ***********************************************************************************************
  Import the Saving target
  ***********************************************************************************************
 -->
  <Import Project="$(DotNetPublishingSaveFilesDirectory)\Microsoft.DotNet.Publishing.SaveFiles.targets"/>
  
  <!--
  ***********************************************************************************************
  Import the Deployment target
  ***********************************************************************************************
 -->
  <PropertyGroup>
    <PublishProtocol Condition="'$(PublishProtocol)' == ''">FileSystem</PublishProtocol>
  </PropertyGroup>
  <Import Project="$(DotNetPublishingDeployFilesDirectory)\Microsoft.$(PublishProtocol).Publishing.targets"/>

  <!--
    ***********************************************************************************************
  Import the CollectFiles
  ***********************************************************************************************
  -->
  <PropertyGroup>
    <PublishProjectType Condition="'$(PublishProjectType)' == '' and '$(OutputType)' =='Exe' ">Console</PublishProjectType>
    <PublishProjectType Condition="'$(PublishProjectType)' == '' and '$(OutputType)' == 'Library'">WebApp</PublishProjectType>
    <PublishProjectType Condition="'$(PublishProjectType)' == '' ">WebSite</PublishProjectType>
  </PropertyGroup>

  <Import Project="$(DotNetPublishingCollectFilesDirectory)\Microsoft.DotNet.$(PublishProjectType).Publishing.CollectFiles.targets"/>

    <!-- Extension points for pre-publish and post-publish events-->
  <Target Name="BeforePublish" />
  <Target Name="AfterPublish" />
  <Target Name="BeforeCollectFiles" />
  <Target Name="AfterCollectFiles" />
  <Target Name="BeforePublishFiles" />
  <Target Name="AfterPublishFiles" />
  
  <!--
  ***********************************************************************************************
  Import the PublishProfiles target
  ***********************************************************************************************
 -->

  <PropertyGroup>
    <PublishProfileRootFolder Condition="'$(PublishProfileRootFolder)' == '' and '$(MSBuildProjectExtension)' =='.vbproj' ">$(MSBuildProjectDirectory)\My Project\PublishProfiles</PublishProfileRootFolder>
    <PublishProfileRootFolder Condition="'$(PublishProfileRootFolder)' == '' and '$(MSBuildProjectExtension)' =='.csproj' ">$(MSBuildProjectDirectory)\Properties\PublishProfiles</PublishProfileRootFolder>
    <PublishProfile Condition="'$(PublishProfile)' ==''">$(PublishProtocol)Profile</PublishProfile>
    <PublishProfileName Condition="'$(PublishProfileName)' == ''">$([System.IO.Path]::GetFileNameWithoutExtension($(PublishProfile)))</PublishProfileName>
    <PublishProfileFullPath Condition="'$(PublishProfileFullPath)' == ''">$(PublishProfileRootFolder)\$(PublishProfileName).pubxml</PublishProfileFullPath>
  </PropertyGroup>
  
  <Import Project="$(PublishProfileFullPath)" Condition="Exists('$(PublishProfileFullPath)')" />
  
  <!--
  ***********************************************************************************************
  TARGET : DotNetPublish
  ***********************************************************************************************
 -->
  <PropertyGroup>
    <DotNetPublishDependsOn>
      BeforePublish;
      CorePublish;
      AfterPublish;
    </DotNetPublishDependsOn>
  </PropertyGroup>

  <Target Name="DotNetPublish" 
          DependsOnTargets="$(DotNetPublishDependsOn)" 
          AfterTargets="Build" 
          Condition=" '$(PublishOnBuild)' =='true' " />

  <PropertyGroup>
    <CorePublishDependsOn>
      $(CorePublishDependsOn);
      BeforeCollectFiles;
      $(DotNetPublishCollectFiles);
      AfterCollectFiles;
      $(DotNetPublishSaveFiles);
      BeforePublishFiles;
      $(DotNetPublishFiles);
      AfterPublishFiles;
    </CorePublishDependsOn>
  </PropertyGroup>
  
  <Target Name="CorePublish"
          DependsOnTargets="$(CorePublishDependsOn)" />
  

</Project>
