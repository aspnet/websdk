<!--
***********************************************************************************************
Microsoft.FileSystem.Publishing.targets 

WARNING:  DO NOT MODIFY this file unless you are knowledgeable about MSBuild and have
          created a backup copy.  Incorrect changes to this file will make it
          impossible to load or build your web deploy projects from the command-line or the IDE.

This file defines the steps in the standard build process to deploy web application projects.

Copyright (C) Microsoft Corporation. All rights reserved.
***********************************************************************************************
-->

<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  
  <UsingTask TaskName="ValidateParameter" AssemblyFile="$(DotNetPublishingTasksDir)Microsoft.DotNet.Publishing.Tasks.dll"/>
  
  <PropertyGroup>
    <DotNetPublishFiles>
      $(DotNetPublishFiles);
      FileSystemPublish;
    </DotNetPublishFiles>
  </PropertyGroup>

  <!--
  ***********************************************************************************************
  TARGET : FileSystemPublish
  ***********************************************************************************************
 -->
  <PropertyGroup>
    <FileSystemPublishDependsOn>
      $(FileSystemPublishDependsOn);
      GatherPublishIntermediateOutputPathFiles;
    </FileSystemPublishDependsOn>
  </PropertyGroup>

  <Target Name="FileSystemPublish" 
          DependsOnTargets="$(FileSystemPublishDependsOn)"
          Inputs="@(_PublishIntermediateOutputPathFiles)"
          Outputs="@(_PublishIntermediateOutputPathFiles ->'$(PublishUrl)\%(RecursiveDir)%(Filename)%(Extension)')">
    
    <ValidateParameter
        ParameterName="PublishUrl"
        ParameterValue="$(PublishUrl)"/>

    <Delete 
      Files="$(PublishUrl)" 
      Condition="'$(DeleteExistingFiles)' == 'true'" 
      />

    <Copy
        SourceFiles="@(_PublishIntermediateOutputPathFiles)"
        DestinationFiles="@(_PublishIntermediateOutputPathFiles ->'$(PublishUrl)\%(RecursiveDir)%(Filename)%(Extension)')"
    />
  </Target>


  <Target Name="GatherPublishIntermediateOutputPathFiles">
    <ItemGroup>
      <_PublishIntermediateOutputPathFiles Include="$(PublishIntermediateOutputPath)\**\*.*" />
    </ItemGroup>
  </Target>
</Project>
